<!DOCTYPE html>
<head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="../bootstrap/css/bootstrap.min.css" media="screen">
    <link rel="stylesheet" href="../bootstrap/css/bootstrap-responsive.min.css">
    <link rel="stylesheet" href="../bootstrap/css/custom.css">
    <script type="text/javascript" src="../js/require.js"></script>
    <title>中国海油物料超市</title>
</head>
<body>
	<div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
	    <div class="container-fluid">
	        <a data-target=".navbar-responsive-collapse" data-toggle="collapse" class="btn btn-navbar">
	            <span class="icon-bar"></span>
	            <span class="icon-bar"></span>
	            <span class="icon-bar"></span>
	        </a>
	        <!-- <a href="#" class="brand">中国海油物料超市</a> -->
	        <div class="nav-collapse collapse navbar-responsive-collapse">
	            <ul class="nav">
	                <li id="nav-sales"><a href="../sales/salescustomer.html">销售</a></li>
	                <li id="nav-product"><a href="../product/prodCategory.html">产品</a></li>
	                <li id="nav-logistics"><a href="../logistics/logisticsreceive.html">库存</a></li>
	                <li id="nav-procurement"><a href="../procurement/supplier.html">采购</a></li>
	                <li id="nav-report"><a href="#">报表</a></li>
	                <li id="nav-setting"><a href="../setting/settingcompany.html">设置</a></li>
	            </ul>
	            <ul class="nav pull-right" id="nav-user">
	                <li>
	                    <a href="#">用户: Administrator</a>
	                </li>
	                <li class="divider-vertical">
	                </li>
	                <li class="dropdown">
	                    <a data-toggle="dropdown" class="dropdown-toggle" href="#">选项<strong class="caret"></strong></a>
	                    <ul class="dropdown-menu">
	                        <li>
	                            <a href="#">Item 1</a>
	                        </li>
	                        <li>
	                            <a href="#">Item 2</a>
	                        </li>
	                        <li>
	                            <a href="#">Others</a>
	                        </li>
	                        <li class="divider">
	                        </li>
	                        <li>
	                            <a href="#">Link 3</a>
	                        </li>
	                    </ul>
	                </li>
	            </ul>
	        </div>
	    </div>
	</div>
	<div class="container-fluid">
		<div class="span2">
			<img src="../img/company-logo-1.png">
			<div class="well sidebar-nav" id="menus">
			    <ul class="nav nav-list" id="menu-sales" style="display: none;">
			        <li class="nav-header">销售</li>
			        <li id="menu-sales-client"><a href="#">客户<span class="badge pull-right">1</span></a></li>
			        <li id="menu-sales-longtermcontracts"><a href="#">长期协议</a></li>
			        <li id="menu-sales-saleorder"><a href="#">销售订单<span class="badge pull-right">1</span></a></li>
			        <li class="nav-header">对账</li>
			        <li id="menu-sales-goodsissue"><a href="#">销售对账</a></li>
			    </ul>
			    <ul class="nav nav-list" id="menu-setting" style="display: none;">
			        <li class="nav-header"> 公司 </li>
			        <li id="menu-setting-company"><a href="#">公司</a></li>
			        <li class="nav-header"> 用户 </li>
			        <li id="menu-setting-user"><a href="#">用户</a></li>
			        <li id="menu-setting-usergroup"><a href="#">用户组</a></li>
			    </ul>
			    <ul class="nav nav-list" id="menu-logistics" style="display: none;">
			        <li class="nav-header"> 收货 </li>
			        <li id="menu-logistics-receive"><a href="./logisticsreceive.html">入库单</a></li>
			        <li class="nav-header"> 发货 </li>
			        <li id="menu-logistics-delivery"><a href="./logisticsdeliver.html">出库单</a></li>
			        <li class="nav-header"> 移库 </li>
			        <li id="menu-logistics-move"><a href="./logisticsmove.html">移库单</a></li>
			        <li class="nav-header"> 盘点 </li>
			        <li id="menu-logistics-makeinventory"><a href="./logisticsmakeinventory.html">实物盘点</a></li>
			        <li class="nav-header"> 库存 </li>
			        <li id="menu-logistics-inventory"><a href="./logisticsinventory.html">库存明细</a></li>
				</ul>
			    <ul class="nav nav-list" id="menu-procurement" style="display: none;">
			        <li class="nav-header"> 采购 </li>
			        <li id="menu-procurement-supplier"><a href="#">供应商</a></li>
			        <li id="menu-procurement-contract"><a href="#">供货协议</a></li>
			        <li id="menu-procurement-order"><a href="#">采购订单</a></li>
			        <li class="nav-header"> MRP </li>
			        <li id="menu-procurement-mrp"><a href="#">计划运行</a></li>
			        <li class="nav-header"> 产品 </li>
			        <li id="menu-procurement-producttype"><a href="#">产品类别</a></li>
			        <li id="menu-procurement-product"><a href="#">产品</a></li>
			    </ul>
			    <ul class="nav nav-list" id="menu-report" style="display: none;">
			        <li class="nav-header"> 销售 </li>
			        <li id="menu-report-salesanalysis"><a href="#">销售分析</a></li>
			        <li class="nav-header"> 库存 </li>
			        <li id="menu-report-inventoryanalysis"><a href="#">库存分析</a></li>
			        <li class="nav-header"> 采购 </li>
			        <li id="menu-report-procurementanalysis"><a href="#">采购分析</a></li>
			    </ul>
			</div>
		</div>
		<div class="span10">
<!-- 			<div class="page-header container-fluid">
			    <div class="row-fluid">
			        <div class="span8">
			            <span id="content-title" style="font-size: 24px;"></span>
			        </div>
			        <div class="span4 list-content">
			            <input type="text" class="search-query" placeholder="Search">
			        </div>
			    </div>
			    <div class="row-fluid">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
			    <div class="row-fluid">
			    	<div class="span5 new-content">
		                <div class="new-content btn-group">
		                    <button class="btn btn-small btn-primary" id="savebutton">保存</button>
		                    <button class="btn btn-small" id="discardbutton">放弃</button>
		                </div>
			    	</div>
	                <div class="span5 list-content">
	                    <button class="btn btn-small btn-primary" id="createbutton1">创建</button>
	                </div>
			        <div class="span5 detail-content">
		                <div class="btn-group">
		                    <button class="btn btn-small btn-primary" id="createbutton">创建</button>
							<button class="btn btn-small" id="editbutton">编辑</button>
		                </div>
		                <div class="btn-group">
		                    <button class="btn btn-small" id="printbutton"><i class="icon-print"></i> 打印</button>
		                    <button class="btn btn-small" id="morebutton"><i class="icon-cog"></i> 更多</button>
		                </div>
	                </div>
			        <div class="span3 list-content detail-content">
			            <span>1 / 1 &nbsp;&nbsp;</span>
			            <div class="btn-group">
				            <button class="btn btn-small"><i class="icon-arrow-left"></i></button>
				            <button class="btn btn-small"><i class="icon-arrow-right"></i></button>
			            </div>
			        </div>
			        <div class="span2 offset1">
			        	<div class="btn-group list-content detail-content" data-toggle="buttons-radio">
				            <button class="btn btn-small" id="showlist" data-toggle="tooltip" title="列表"><i class="icon-list"></i></button>
				            <button class="btn btn-small" id="showdetail" data-toggle="tooltip" title="详细信息"><i class="icon-edit"></i></button>
			            </div>
			        </div>
			    </div>
			</div>
 -->			
			<div class="page-header container-fluid">
			    <div class="row-fluid">
			        <div class="span8">
			            <span id="content-title" style="font-size: 24px;"></span>
			        </div>
			        <div class="span4 list-content">
			            <input type="text" class="search-query" placeholder="Search">
			        </div>
			    </div>
			    <div class="row-fluid">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
			    <div class="row-fluid">
			        <div class="span12">
			            <div class="row-fluid">
			                <div class="list-content detail-content">
			                	<div class="span10">
				                	<div class="list-content">
					                    <button class="btn btn-danger btn-small" id="createbutton"><i class="icon-pencil"></i> 创建</button>
					                    <button class="btn btn-small"><i class="icon-arrow-up"></i> 导入</button>
						                <div class="btn-group">
											<a class="btn dropdown-toggle btn-small" data-toggle="dropdown" href="#">
												<i class="icon-print"></i>
												打印 
												<span class="caret"></span>
											</a>
											<ul class="dropdown-menu">
												<li><a href="#">打印所选</a></li>
												<li><a href="#">打印全部</a></li>
											</ul>
										</div>
							            <div class="btn-group">
											<a class="btn dropdown-toggle btn-small" data-toggle="dropdown" href="#">
												<i class="icon-cog"></i>
												更多 
												<span class="caret"></span>
											</a>
											<ul class="dropdown-menu">
												<li><a href="#">删除</a></li>
												<li><a href="#">更新</a></li>
												<li><a href="#">其他</a></li>
											</ul>
										</div>
									</div>
				                	<div class="detail-content">
					                    <button class="btn btn-small" id="editbutton"><i class="icon-edit"></i> 编辑</button>
					                    <button class="btn btn-small" id="createbutton1"><i class="icon-pencil"></i> 创建</button>
									</div>								
								</div>
								<div class="span2 btn-group" data-toggle="buttons-radio">
						            <abbr title="显示列表"><button class="btn active btn-small" id="showlist" data-toggle="tooltip"><i class="icon-list"></i></button></abbr>
									<abbr title="查看详情"><button class="btn btn-small" id="showdetail" data-toggle="tooltip"><i class="icon-resize-full"></i></button></abbr>
					            </div>
					        </div>
			                <div class="new-content">
			                    <button class="btn btn-primary btn-small" id="savebutton"><i class="icon-ok"></i> 保存</button>
			                    <button class="btn btn-small" id="discardbutton"><i class="icon-remove"></i> 放弃</button>
			                </div>
			            </div>
			        </div>
			    </div>
			</div>
 			<input type="hidden" value="makeinventory" id="currentpage">
			<input type="hidden" value="logistics" id="currentmenu">
			<input type="hidden" value="盘点单" id="thistitle">
			<div class="ebiz detail-content new-content row-fluid">
				<h1 class="pull-left" style="line-height: 18px;"><span id="detail-codeitem"></span></h1>
				<div class="btn-group pull-left" style="padding-left: 35px; padding-bottom: 35px; display: none;" id="detail-functionbuttongroup">
					<button class="btn btn-small btn-danger" id="detail-receivebutton">确认</button>
					<button class="btn btn-small" id="detail-cancelbutton">取消</button>
				</div>
				<ul class="oe_form_field_status oe_form_status pull-right">
					<li class="statusbar" id="status-draft">
						<span class="oe_label">草稿</span>
						<span class="oe_arrow"><span></span></span>
					</li>
					<li class="statusbar oe_active" id="status-tobeconfirmed">
						<span class="oe_label">待确认</span>
						<span class="oe_arrow"><span></span></span>
					</li>
					<li class="statusbar" id="status-done">
						<span class="oe_label" data-id="status-done">已完成</span>
						<span class="oe_arrow"><span></span></span>
					</li>
				</ul>
			</div>
			<div class="list-content" style="display: block;">
			    <table class="table table-condensed">
			        <thead>
			        <tr>
			        	<th><input type="checkbox" id="list-head-checkbox"></th>
			            <th>盘点单编号</th>
 						<th>创建人</th>
			            <th>创建时间</th>
			            <th>完成时间</th>
			            <th>状态</th>
			        </tr>
			        </thead>
			        <tbody id="listbody"></tbody>
			    </table>
			</div>
			<div class="detail-content" style="display: none;">
				<br>
				<input type="hidden" value="" id="detail-contentobjitem">
<!--                 <div class="row-fluid">
                    <div class="span5">
                    	<table class="table table-condensed">
	                    	<tr><th>状态</th><td id="detail-statusitem"></td></tr>
		                    <tr><th>经办人</th><td id="detail-creatoritem"></td></tr>
                    	</table>
                    </div>
                    <div class="span6 offset1">
	                    <table class="table table-condensed">
 		                    <tr><th>创建时间</th><td id="detail-createtimeitem"></td></tr>
 		                    <tr><th>完成时间</th><td id="detail-finishtimeitem"></td></tr>
	                    </table>
                    </div>
                </div>
 -->
				<div class="row-fluid">
					<div class="span2">
						<div style="float:right">状态</div>
					</div>
					<div class="span4" id="detail-statusitem"></div>
					<div class="span2">
						<div style="float:right">经办人</div>
					</div>
					<div class="span4" id="detail-creatoritem"></div>
				</div>			
				<div class="row-fluid">
					<div class="span2">
						<div style="float:right">创建时间</div>
					</div>
					<div class="span4" id="detail-createtimeitem"></div>
					<div class="span2">
						<div style="float:right">完成时间</div>
					</div>
					<div class="span4" id="detail-finishtimeitem"></div>
				</div>			
                <div class="row-fluid">
                	<div class="span12">
                		<div class="row-fluid">
                			<ul class="nav nav-tabs">
                				<li class="active" id="producttab"><a id="producttaba">盘点项目</a></li>
<!--                 				<li id="otherinfotab"><a id="otherinfotaba">已记录的盘点</a></li>
 -->                			</ul>
                		</div>
                		<div class="row-fluid" id="productdiv">
						    <table class="table table-condensed">
						    <thead>
						    	<tr>
						    	<th>库存编码</th>
						    	<th>产品名称</th>
						    	<th>产品编码</th>
						    	<th>仓库</th>
						    	<th>仓位</th>
						    	<th>创建时间</th>
						    	<th>实际库存</th>
						    	<th>盈亏</th>
						    	<th>可用量</th>
						    	<th>盈亏</th>
						    	<th>单位</th>
						    	</tr>
						    </thead>
						    <tbody id="detail-productlistitem"></tbody>
						    </table>
                		</div>
                		<div class="row-fluid" id="otherinfodiv" style="display: none;">
						    <table class="table table-condensed">
						    <thead>
						    	<tr>
						    	<th>产品</th>
						    	<th>数量</th>
						    	<th>源库位</th>
						    	<th>目标库位</th>
						    	<th>日期</th>
						    	</tr>
						    </thead>
						    <tbody id="detail-makeinventorylistitem"></tbody>
						    </table>
                		</div>
                	</div>
                </div>
			</div>
			<div class="new-content" style="display: none;">
				<input type="hidden" value="none" id="new-contentobjitem">
				<br>
				<div id="new-searchinventory" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="searchlabel" aria-hidden="true">
					<div class="modal-header">
						<button class="close" data-dismiss="modal" aria-hidden="true">x</button>
						<h3 id="searchlabel">搜索库存</h3>
					</div>
					<div class="modal-body">
						<table class="table">
							<tr><th>供应商</th><td><input type="text"></td></tr>
							<tr><th>名称</th><td><input type="text"></td></tr>
							<tr><th>单号</th><td><input type="text"></td></tr>
							<tr><th>库存编号</th><td><input type="text"></td></tr>
							<tr><th>仓库</th><td><input type="text"></td></tr>
							<tr><th>仓位</th><td><input type="text"></td></tr>
							<tr><th>搜索</th><td><button class="btn btn-primary">搜索</button></td></tr>
						</table>
					</div>
					<div class="modal-footer">
						<button class="btn btn-small" data-dismiss="modal" aria-hidden="true">关闭</button>
						<button class="btn btn-small btn-primary">确定</button>
					</div>
				</div>
				<br/>
				<ul class="nav nav-tabs">
					<li id="new-producttab" class="active"><a id="new-producttaba">盘点项目</a></li>
				</ul>			
				<div class="tab-pane active" id="new-productitem">
				    <table class="table table-condensed">
				        <thead>
					        <tr>
						    	<th>库存编码</th>
						    	<th>产品名称</th>
						    	<th>产品编码</th>
						    	<th>仓库</th>
						    	<th>仓位</th>
						    	<!-- <th>创建时间</th> -->
						    	<th>实际库存</th>
						    	<th>盈亏</th>
						    	<th>可用量</th>
						    	<th>盈亏</th>
						    	<th>单位</th>
					        </tr>					        
				        </thead>
				        <tbody id="new-productlist">
				        	<tr><td><a id="new-addnewitem" href="#new-searchinventory" role="button" data-toggle="modal">添加一个新的项目</a></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
				        </tbody>
			        </table>
				</div>
				<div class="tab-pane" id="new-descriptionitem" style="display: none;">
					<textarea class="span8" rows="3" id="new-descriptiontext"></textarea>
				</div>
			</div>
		</div>
	</div>
	<script type="text/javascript">
		require(["jquery", "logisticsdata", "bootstrap", "domReady!"], function($, logisticsdata){
			// Logics within the application page
			var data = logisticsdata.makeinventory;
			var querytems = logisticsdata.querytems;
			var months = logisticsdata.months;
			var otherorders = logisticsdata.otherorders;
			var typemap = logisticsdata.typemap;
			var statusmap = logisticsdata.statusmap;

			var curorder = null;

			var currentview = "";

			var changestatus = function(status){
				status = statusmap[status];
				$(".statusbar").removeClass("oe_active");
				$("#status-" + status).addClass("oe_active");
			};
			var fillnew = function(data){
				var _data = {
					"code": "",
					"creator": "Administrator",
					"createtime": "",
					"finishtime": "-",
					"status": "草稿",
					"inventory": null
				};
				if(data != undefined) {
					for(var _k in _data){
						var _v = data[_k];
						if(_v != undefined){
							_data[_k] = _v;
						}
					}
				};
				$("#new-createtimeitem").html(_data["description"]);
				$("#new-creatoritem").html(_data["creator"]);
				changestatus(_data["status"]);
				var _listcontent = "";
				var _inventory= _data["inventory"];
				if(_inventory != null){
					for (var i = 0; i < _inventory.length; i++) {
						_listcontent += "<tr>";
						var pitems = ["code", "productname", "productcode", "site", "position", "quantityinhand", "quantityinhandvar", "quantityexpect", "quantityexpectvar", "unit"];
						for(var j = 0; j < pitems.length; j++){
							var k = pitems[j];
							_listcontent += "<td>";
							if(k != "quantityexpectvar" && k != "quantityinhandvar"){
								_listcontent += _inventory[i][k];
							} else {
								_listcontent += "<input type='text' class='span1' value='" + _inventory[i][k] + "'>";
							}
							_listcontent += "</td>";
						}
						_listcontent += "</tr>";
					}
				}
				$("#new-productlist").html(_listcontent);
			};

	    	var showview = function(view){
	        	$(".detail-content").css("display", "none");
	        	$(".new-content").css("display", "none");
	            $(".list-content").css("display", "none");
	            $("." + view + "-content").css("display", "block");
	            currentview = view;
	    	};
	        var showlist = function(){
	        	showview("list");
	        };
	        var showdetail = function(){
	        	showview("detail");
	        };
	        var shownew = function(){
	        	showview("new");
	        	$(".statusbar").removeClass("oe_active");
	        	$("#status-draft").addClass("oe_active");
	        	$("#detail-functionbuttongroup").css("display", "none");
				var maxcode = 0;
				for(var i = 0; i < data.length; i++){
					var _code = data[i]["code"].split("-")[1];
					_code = new Number(_code);
					if(_code > maxcode)
						maxcode = _code;
				}
				maxcode++;
	        	$("#detail-codeitem").html("MI-000" + maxcode);
	        	fillnew();
	        };
			var lookforitem = function(code){
				var obj = null;
				for(var i = 0; i < data.length; i++)
					if(data[i]["code"] == code)
						obj = data[i];
				return obj;
			}

			var getcurrenttime = function(){
				var date = new Date().toString().split(" ");
				return date[2] + "/" + months[date[1]] + "/" + date[3] + " " + date[4];
			}

			var addrowtolist = function(){
                var html = "";
                var items = ["code", "creator", "createtime", "finishtime", "status"];
            	var invitems = ["site", "position", "productcode", "productname"];
                var as = [];
                var itemlink = function(){
                	var code = $(this).attr("id");
                	$("#detail-contentobjitem").val(code);
                	filldetail(lookforitem(code));
		        	$("#showdetail").click()
                };
				for(var i = 0; i < data.length; i++){
                    html += "<tr><td><input class='list-checkbox' type='checkbox'></td>";
                    html += "<td><a href='#' id='" + data[i]["code"] + "'>" + data[i]["code"] + "</a></td>"
                    as.push(data[i]["code"]);
                    for(var j = 1; j < items.length; j++){
                    	var key = items[j];
                    	if(key != "inventory"){
	                    	html += "<td>";
	                    	html += data[i][key];
	                    	html += "</td>";
	                    } else {
	                    	var inventory = data[i][key];
	                    	for(var k = 0; k < invitems.length; k++){
	                    		var invkey = invitems[k];
                    			html += "<td>" + inventory[invkey] + "</td>";
	                    	}
	                    }
                    }
                    html += "</tr>";
				}
                $("#listbody").html(html);

                for(var i = 0; i < as.length; i++)
                	$("#" + as[i]).click(itemlink);
			};

			var filldetail = function(data){
				$("#detail-contentobjitem").val(data["code"]);
				$("#detail-codeitem").html(data["code"]);
				$("#detail-statusitem").html(data["status"]);
				$("#detail-createtimeitem").html(data["createtime"]);
				$("#detail-finishtimeitem").html(data["finishtime"]);
				$("#detail-creatoritem").html(data["creator"]);
				if(data["status"] == "已完成" || data["status"] == "已取消"){
					$("#detail-functionbuttongroup").css("display", "none");
				} else {
					$("#detail-functionbuttongroup").css("display", "block");
				}

				changestatus(data["status"]);

				if(data["inventory"].length < 1) {
					$("#detail-productlistitem").html("");
					return;
				}

				var inventoryhtml = "";
				var makeinventorylisthtml = "";
				var invitems = [ "code", "productname", "productcode", "site", "position", "createtime", "quantityinhand", "quantityinhandvar", "quantityexpect", "quantityexpectvar", "unit"];
				var mkinvitems = ["productname", "quantityinhand", "source", "site", "createtime"];
				var invlist = data["inventory"];
				for(var i = 0; i < invlist.length; i++){
					var inv = invlist[i];
					inventoryhtml += "<tr>";
					makeinventorylisthtml += "<tr>";
					for(var j = 0; j < invitems.length; j++){
						var key = invitems[j];
						inventoryhtml += "<td>" + inv[key] + "</td>";
					}
					for(var j = 0; j < mkinvitems.length; j++){
						var key = mkinvitems[j];
						makeinventorylisthtml += "<td>" + inv[key] + "</td>";
					}
					inventoryhtml += "</tr>";
					makeinventorylisthtml += "</tr>";
				}
				$("#detail-makeinventorylistitem").html(makeinventorylisthtml);
				$("#detail-productlistitem").html(inventoryhtml);

			};

			var initbuttons = function(){
		    	$("#content-title").html($("#thistitle").val());
		        $("#showlist").click(showlist);
		        $("#showdetail").click(showdetail);
		        $("#createbutton").click(shownew);
		        $("#createbutton1").click(shownew);
		        $("#discardbutton").click(showlist);
		        $("#editbutton").click(function(){
		        	var _data = lookforitem($("#detail-codeitem").html());
		        	showview("new");
		        	changestatus(_data["status"]);
		        	fillnew(_data);
		        	$("#detail-functionbuttongroup").css("display", "none");
		        });
				$("#producttaba").click(function(){
					$("#productdiv").css("display", "block");
					$("#otherinfodiv").css("display", "none");
					$("#otherinfotab").removeClass("active");
					$("#producttab").addClass("active");
				});
				$("#otherinfotab").click(function(){
					$("#productdiv").css("display", "none");
					$("#otherinfodiv").css("display", "block");
					$("#producttab").removeClass("active");
					$("#otherinfotab").addClass("active");
				});
				$("#list-head-checkbox").click(function(){
					var cbx = $(".list-checkbox").click();
				});
				$("#detail-receivebutton").click(function(){
					var obj = lookforitem($("#detail-contentobjitem").val());
					var date = new Date().toString().split(" ");
					obj["status"] = "已完成";
					obj["finishtime"] = getcurrenttime();
					filldetail(obj);
					addrowtolist(data);
				});
				$("#detail-cancelbutton").click(function(){
					var obj = lookforitem($("#detail-contentobjitem").val());
					var date = new Date().toString().split(" ");
					obj["status"] = "已取消";
					obj["finishtime"] = getcurrenttime();
					filldetail(obj);
					addrowtolist(data);
				});
				$("#new-producttaba").click(function(){
					$("#new-descriptiontab").removeClass("active");
					$("#new-producttab").addClass("active");
					$("#new-descriptionitem").css("display", "none");
					$("#new-productitem").css("display", "block");
				});
				$("#new-descriptiontaba").click(function(){
					$("#new-descriptiontab").addClass("active");
					$("#new-producttab").removeClass("active");
					$("#new-descriptionitem").css("display", "block");
					$("#new-productitem").css("display", "none");
				});
				$("#new-productcodeitem").typeahead({
					source: querytems,
					items: 10,
					minLength: 1,
				});
				$("#new-productcodeconfirm").click(function(){
					var _data = otherorders;
					var text = $("#new-productcodeitem").val();
					var order = null;
					for(var i = 0; i < _data.length; i++)
						if(_data[i]["code"] == text)
							order = _data[i];
					var con = {
						"productcode": order["code"],
						"product": order,
						"inventory": order["inventory"],
						"source": $("#new-sourceitem").val(),
						"target": $("#new-targetitem").val(),
					};

					fillnew(con);
				});
				$("#savebutton").click(function(){
					var neworder = {};
					neworder["code"] = $("#detail-codeitem").html();
					neworder["createtime"] = getcurrenttime();
					neworder["finishtime"] = "-";
					neworder["deliverytime"] = "-";
					neworder["productcode"] = $("#new-productcodeitem").val();
					neworder["inventorycode"] = $("#new-inventorycodeitem").html();
					neworder["status"] = "待确认";
					neworder["creator"] = "Administrator";
					neworder["target"] = $("#new-targetitem").val();
					neworder["source"] = $("#new-sourceitem").val();
					neworder["description"] = $("#new-descriptiontext").html();
					neworder["inventory"] = [];
					for(var i = 0; i < otherorders.length; i++){
						var _o = otherorders[i];
						if($("#new-productcodeitem").val() == _o["code"]){
							neworder["product"] = _o;
							break;
						}
					}

					var obj = lookforitem($("#detail-codeitem").html());
					if(obj == null)
						data.push(neworder);
					else
						obj = neworder;
					addrowtolist(data);
					filldetail(neworder);
					$("#showdetail").click();
				});
			};

            addrowtolist(data);
            initbuttons();
            filldetail(data[0]);
	        $("#showlist").click();
		});
	</script>
	</div>
	<div id="foot">
	    <script type="text/javascript" src="../js/commonactions.js"></script>
	</div>
</body>